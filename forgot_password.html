<!-- Author; bIRAJ Man Tamang -->
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Character encoding for displaying text properly -->
    <meta charset="UTF-8">
    
    <!-- Makes the page responsive on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Title shown in the browser tab -->
    <title>Forgot Password - McNeese Parking Services</title>
    
    <!-- Link to the main CSS stylesheet for styling -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 

    HEADER SECTION
    Contains the logo and navigation menu

    -->
    <header class="header">
        <div class="container">
            <!-- 
            LOGO AREA
            Shows university branding with image and text
            -->
            <div class="logo">
                <!-- University logo image -->
                <div class="logo-icon">
                    <img src="download.png" alt="McNeese Logo" width="100" height="50">
                </div>
                
                <!-- Text branding next to logo -->
                <div class="logo-text">
                    <h1>McNeese State University</h1>
                    <p>Parking Services</p>
                </div>
            </div>
            
            <!-- 
            NAVIGATION MENU
            Links to main pages of the website
            -->
            <nav class="nav">
                <a href="index.php" class="nav-link">Home</a>
                <a href="about.html" class="nav-link">About</a>
                <a href="login.html" class="nav-link">Login</a>
            </nav>
        </div>
    </header>

    <!-- 
    ================================================
    MAIN CONTENT AREA
    Contains the forgot password form
    Extra margin on top and bottom for spacing
    ================================================
    -->
    <div class="form-container" style="margin-top: 60px; margin-bottom: 60px;">
        <!-- Page title explaining what this page does -->
        <h2 class="form-title">Forgot Password?</h2>
        
        <!-- Helpful instructions for the user -->
        <p class="form-subtitle">Enter your University email and we'll send you a password reset link</p>
        
        <!-- 
        ALERT CONTAINER
        This is where success or error messages will appear
        Starts empty, JavaScript fills it in when needed
        -->
        <div id="alertContainer"></div>
        
        <!-- 
        PASSWORD RESET FORM
        When submitted, calls the handleForgotPassword function
        -->
        <form id="forgotPasswordForm" onsubmit="handleForgotPassword(event)">
            <!-- 
            EMAIL INPUT FIELD
            User enters their university email here
            Required field (cannot be left empty)
            -->
            <div class="form-group">
                <label for="email" class="form-label">University Email</label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    class="form-input" 
                    placeholder="your.email@mcneese.edu"
                    required
                >
            </div>
            
            <!-- Submit button to send the reset link request -->
            <button type="submit" class="btn-primary">Send Reset Link</button>
        </form>
        
        <!-- 
        BACK TO LOGIN LINK
        If user remembers password, they can go back to login
        -->
        <div style="text-align: center; margin-top: 20px;">
            <p>Remember your password? <a href="login.html" style="color: var(--primary-blue); text-decoration: none; font-weight: 600;">Back to Login</a></p>
        </div>
    </div>

    <!-- 
    ================================================
    FOOTER SECTION
    Contact info, office hours, and quick links
    Appears at the bottom of the page
    ================================================
    -->
    <footer class="footer">
        <div class="container footer-content">
            <!-- 
            COLUMN 1: Contact Information
            Phone, email, and physical address
            -->
            <div class="footer-section">
                <h3>Contact Information</h3>
                <p>üìû (337) 475-5000</p>
                <p>‚úâÔ∏è parking@mcneese.edu</p>
                <p>üìç 4205 Ryan St.<br>Lake Charles, LA 70609</p>
            </div>
            
            <!-- 
            COLUMN 2: Office Hours
            When the parking office is open
            -->
            <div class="footer-section">
                <h3>Office Hours</h3>
                <p>Monday ‚Äì Friday: 8:00 AM ‚Äì 5:00 PM</p>
                <p>Saturday: 9:00 AM ‚Äì 1:00 PM</p>
                <p>Sunday: Closed</p>
            </div>
            
            <!-- 
            COLUMN 3: Quick Links
            Links to helpful resources
            -->
            <div class="footer-section">
                <h3>Quick Links</h3>
                <p><a href="#" class="footer-link">Parking Regulations</a></p>
                <p><a href="#" class="footer-link">Appeal Process</a></p>
                <p><a href="#" class="footer-link">FAQ</a></p>
            </div>
        </div>
        
        <!-- Copyright notice at very bottom -->
        <div class="footer-bottom">
            <p>¬© 2025 McNeese State University. All rights reserved.</p>
        </div>
    </footer>

    <!-- 
    JAVASCRIPT CODE
    Handles the forgot password form submission

    -->
    <script>
        // Base URL for all API requests to the server
        const API_BASE = 'https://mcneeseparking.infinityfree.me/api/';

        // HANDLE FORGOT PASSWORD FORM SUBMISSION
        // This function runs when user submits the form

        function handleForgotPassword(event) {
            // Stop the form from submitting normally (which would refresh the page)
            event.preventDefault();
            
            // Get the email address the user typed in
            const email = document.getElementById('email').value.trim();
                        // VALIDATION: Check if email is valid
            // Must be a McNeese university email address
            if (!email.endsWith('@mcneese.edu')) {
                // Show error message if not a McNeese email
                showAlert('Please use your McNeese State University email address.', 'error');
                return; // Stop here, don't send request
            }
            
            // Get the submit button so we can disable it during the request
            const submitBtn = event.target.querySelector('button[type="submit"]');
            
            // Disable the button and change text to show it's working
            submitBtn.disabled = true;
            submitBtn.textContent = 'Sending...';
            
            // ============================================
            // SEND REQUEST TO SERVER
            // Ask server to send password reset email
            // /
            
            // Prepare the data to send
            const formData = new FormData();
            formData.append('action', 'forgotPassword');
            formData.append('email', email);
            
            // Send the request to the server
            fetch(API_BASE + 'auth_api.php', {
                method: 'POST',
                body: formData,
                credentials: 'include' // Include cookies if needed
            })
            .then(response => response.json()) // Convert response to JSON
            .then(data => {
                // Check if the request was successful
                if (data.success) {
                    // Show success message to the user
                    showAlert('Password reset link has been sent to your email. Please check your inbox.', 'success');
                    
                    // Clear the email field
                    document.getElementById('email').value = '';
                    
                    // After 3 seconds, redirect to login page
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 3000);
                } else {
                    // If request failed, show error message from server
                    showAlert(data.message || 'Unable to process request. Please try again.', 'error');
                }
            })
            .catch(error => {
                // If there's a connection error, show user-friendly message
                console.error('Error:', error);
                showAlert('Connection error. Please check your internet and try again.', 'error');
            })
            .finally(() => {
                // Re-enable the button and restore original text
                // This runs whether the request succeeded or failed
                submitBtn.disabled = false;
                submitBtn.textContent = 'Send Reset Link';
            });
        }
        
        // /
        // SHOW ALERT MESSAGE
        // Displays colored message boxes for success/error
      
        function showAlert(message, type = 'success') {
            // Find the container where alerts are displayed
            const alertContainer = document.getElementById('alertContainer');
            if (!alertContainer) return; // If container doesn't exist, stop here
            
            // Choose the CSS class based on type
            // success = green box, error = red box
            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            
            // Create the alert box with the message
            alertContainer.innerHTML = `
                <div class="alert ${alertClass}" role="alert">
                    ${message}
                </div>
            `;
            
            // Automatically remove the alert after 5 seconds
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }
    </script>
</body>
</html>